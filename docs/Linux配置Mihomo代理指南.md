# Linux æœåŠ¡å™¨é…ç½® Mihomo (Clash Meta) æŒ‡å—

## ğŸ“‹ 1. å‡†å¤‡å·¥ä½œ (åœ¨ Windows æœ¬åœ°å®Œæˆ)

ç”±äºæœåŠ¡å™¨æ— æ³•è®¿é—® GitHubï¼Œæˆ‘ä»¬éœ€è¦åœ¨æœ¬åœ°ç”µè„‘å‡†å¤‡å¥½æ‰€æœ‰æ–‡ä»¶ï¼Œç„¶åä¸€æ¬¡æ€§ä¸Šä¼ ã€‚

### A. ä¸‹è½½æ ¸å¿ƒç¨‹åº

  * **ä¸‹è½½åœ°å€**ï¼š[Mihomo GitHub Releases](https://github.com/MetaCubeX/mihomo/releases)
  * **é€‰æ‹©ç‰ˆæœ¬**ï¼š`mihomo-linux-amd64-v1-v1.xx.xx.gz` (é€‰æ‹© Compatible/v1 ç‰ˆæœ¬æœ€ç¨³å¦¥)ã€‚
  * **å¤„ç†**ï¼šè§£å‹æ–‡ä»¶ï¼Œå°†è§£å‹åçš„æ–‡ä»¶é‡å‘½åä¸º **`mihomo`**ã€‚

### B. ä¸‹è½½å¿…è¦æ•°æ®åº“ (Geo æ–‡ä»¶)

Mihomo å¯åŠ¨å¿…é¡»ä¾èµ–è¿™ä¸‰ä¸ªæ–‡ä»¶ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚

  * **ä¸‹è½½åœ°å€**ï¼š[Meta-rules-dat](https://www.google.com/search?q=https://github.com/MetaCubeX/meta-rules-dat/releases/tag/latest)
  * **æ–‡ä»¶åˆ—è¡¨**ï¼š
    1.  `Country.mmdb`
    2.  `geosite.dat`
    3.  `geoip.dat`

### C. å‡†å¤‡é…ç½®æ–‡ä»¶ (config.yaml)

1.  **è®¢é˜…è½¬æ¢**ï¼šä½¿ç”¨åœ¨çº¿è½¬æ¢å·¥å…·ï¼ˆå¦‚ ACL4SSRï¼‰æˆ– Windows ä¸Šçš„ Clash Vergeï¼Œå°†ä½ çš„è®¢é˜…é“¾æ¥è½¬æ¢ä¸º YAML æ–‡ä»¶ã€‚
2.  **é‡å‘½å**ï¼šå°†æ–‡ä»¶é‡å‘½åä¸º `config.yaml`ã€‚
3.  **ç¼–è¾‘æ–‡ä»¶ (å…³é”®)**ï¼šç”¨è®°äº‹æœ¬æ‰“å¼€ `config.yaml`ï¼Œ**æ›¿æ¢/ä¿®æ”¹**æ–‡ä»¶å¤´éƒ¨å¦‚ä¸‹ï¼Œä»¥é˜²æ­¢ç«¯å£å†²çªå¹¶å…è®¸è¿œç¨‹ç®¡ç†ï¼š

<!-- end list -->

```yaml
# --------- å¤´éƒ¨é…ç½®å¼€å§‹ ---------
port: 7890               # HTTP ä»£ç†ç«¯å£
socks-port: 7891         # SOCKS5 ä»£ç†ç«¯å£
mixed-port: 7893         # æ··åˆç«¯å£ (å»ºè®®é¿å¼€ 7890ï¼Œé˜²æ­¢å†²çª)
allow-lan: true          # å…è®¸å±€åŸŸç½‘è¿æ¥
bind-address: "*"        # ç»‘å®šæ‰€æœ‰ IP
mode: rule               # è§„åˆ™æ¨¡å¼
log-level: info
ipv6: false              # å»ºè®®å…³é—­ IPv6

# Web Dashboard ç®¡ç†é…ç½®
external-controller: 0.0.0.0:9090
secret: "123456"         # åŠ¡å¿…è®¾ç½®å¯†ç 
# --------- å¤´éƒ¨é…ç½®ç»“æŸ ---------
```

-----

## ğŸ“¤ 2. ä¸Šä¼ ä¸å®‰è£… (åœ¨æœåŠ¡å™¨æ“ä½œ)

### A. åˆ›å»ºç›®å½•å¹¶ä¸Šä¼ 

1.  åœ¨æœåŠ¡å™¨ç»ˆç«¯åˆ›å»ºç»Ÿä¸€ç›®å½•ï¼š
    ```bash
    mkdir -p /opt/mihomo
    ```
2.  ä½¿ç”¨ SFTP å·¥å…·ï¼ˆFinalShell, Xftp, VSCode ç­‰ï¼‰å°†ç”µè„‘ä¸Šå‡†å¤‡å¥½çš„ **5ä¸ªæ–‡ä»¶** ä¸Šä¼ åˆ° `/opt/mihomo/` ç›®å½•ã€‚
      * `mihomo` (ä¸»ç¨‹åº)
      * `config.yaml`
      * `Country.mmdb`
      * `geosite.dat`
      * `geoip.dat`

### B. èµ‹äºˆæƒé™

åœ¨æœåŠ¡å™¨ç»ˆç«¯æ‰§è¡Œï¼š

```bash
# èµ‹äºˆä¸»ç¨‹åºæ‰§è¡Œæƒé™
chmod +x /opt/mihomo/mihomo
```

-----

## âš™ï¸ 3. é…ç½®å¼€æœºè‡ªå¯ (Systemd)

ä¸ºäº†è®©ä»£ç†åœ¨åå°é»˜é»˜è¿è¡Œï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªç³»ç»ŸæœåŠ¡ã€‚

1.  **åˆ›å»ºæœåŠ¡æ–‡ä»¶**ï¼š

    ```bash
    nano /etc/systemd/system/mihomo.service
    ```

2.  **å¡«å…¥ä»¥ä¸‹å†…å®¹**ï¼š

    ```ini
    [Unit]
    Description=Mihomo Daemon
    After=network.target

    [Service]
    Type=simple
    Restart=always
    # æ³¨æ„è·¯å¾„å¿…é¡»å¯¹åº”
    ExecStart=/opt/mihomo/mihomo -d /opt/mihomo -f /opt/mihomo/config.yaml

    [Install]
    WantedBy=multi-user.target
    ```

    *(æŒ‰ `Ctrl+O` ä¿å­˜ï¼Œ`Enter` ç¡®è®¤ï¼Œ`Ctrl+X` é€€å‡º)*

3.  **å¯åŠ¨æœåŠ¡**ï¼š

    ```bash
    systemctl daemon-reload   # é‡è½½é…ç½®
    systemctl enable mihomo   # è®¾ç½®å¼€æœºè‡ªå¯
    systemctl start mihomo    # ç«‹å³å¯åŠ¨
    ```

4.  **æ£€æŸ¥çŠ¶æ€**ï¼š

    ```bash
    systemctl status mihomo
    ```

    *å¦‚æœçœ‹åˆ°ç»¿è‰²çš„ `active (running)`ï¼Œè¯´æ˜éƒ¨ç½²æˆåŠŸï¼*

-----

## ğŸ’» 4. è¿æ¥ Web Dashboard (å¯è§†åŒ–ç®¡ç†)

ç”±äº AutoDL ç­‰æœåŠ¡å™¨å¤„äº NAT ç½‘ç»œï¼Œæ— æ³•ç›´æ¥è®¿é—®å…¬ç½‘ IPï¼Œéœ€è¦ä½¿ç”¨ **SSH éš§é“** è®¿é—®é¢æ¿ã€‚

### è¿æ¥æ–¹æ³• (ä¸‰é€‰ä¸€)

  * **æ–¹æ³• A: VS Code (æœ€æ¨è)**
    åœ¨ VS Code åº•éƒ¨é¢æ¿ç‚¹å‡» `PORTS` (ç«¯å£) -\> `Add Port` -\> è¾“å…¥ `9090`ã€‚

  * **æ–¹æ³• B: SSH å‘½ä»¤è¡Œ**
    åœ¨æœ¬åœ°ç”µè„‘è¿æ¥æœåŠ¡å™¨æ—¶ï¼Œæ·»åŠ  `-L` å‚æ•°ï¼š

    ```bash
    ssh -L 9090:127.0.0.1:9090 root@ä½ çš„æœåŠ¡å™¨IP -p ç«¯å£
    ```

  * **æ–¹æ³• C: FinalShell / Xshell**
    åœ¨è¿æ¥å±æ€§ä¸­æ‰¾åˆ°â€œSSH éš§é“/Tunnelâ€ï¼Œæ·»åŠ â€œæœ¬åœ°è½¬å‘â€ï¼š

      * æºç«¯å£: `9090`
      * ç›®æ ‡ä¸»æœº: `127.0.0.1`
      * ç›®æ ‡ç«¯å£: `9090`

### æ‰“å¼€é¢æ¿

1.  åœ¨**æœ¬åœ°ç”µè„‘æµè§ˆå™¨**æ‰“å¼€ï¼š[http://yacd.haishan.me/](http://yacd.haishan.me/)
2.  é…ç½®è¿æ¥ä¿¡æ¯ï¼š
      * **API Base URL**: `http://127.0.0.1:9090` (æ³¨æ„è¿™é‡Œå¡« 127.0.0.1)
      * **Secret**: `123456` (ä½ é…ç½®çš„å¯†ç )
3.  ç‚¹å‡» **Add**ï¼Œå¹¶åœ¨ **Proxies** é¡µé¢é€‰æ‹©èŠ‚ç‚¹ï¼ˆå¦‚æ–°åŠ å¡èŠ‚ç‚¹ï¼‰ã€‚

-----

## ğŸš€ 5. å¦‚ä½•ä½¿ç”¨ä»£ç†

Mihomo è¿è¡Œåï¼ŒæœåŠ¡å™¨çš„æµé‡**é»˜è®¤ä¸ä¼š**è‡ªåŠ¨èµ°ä»£ç†ã€‚ä½ éœ€è¦åœ¨éœ€è¦çš„æ—¶å€™æ‰‹åŠ¨æŒ‡å®šã€‚

### åœºæ™¯ A: ä¸´æ—¶è®©å½“å‰ç»ˆç«¯èµ°ä»£ç† (æœ€å¸¸ç”¨)

åœ¨æ‰§è¡Œ `git clone`, `wget`, `pip install` ä¹‹å‰ï¼Œè¿è¡Œï¼š

```bash
export http_proxy=http://127.0.0.1:7890
export https_proxy=http://127.0.0.1:7890
export all_proxy=socks5://127.0.0.1:7891
```

**æµ‹è¯•æ˜¯å¦ç”Ÿæ•ˆï¼š**

```bash
curl -I https://www.google.com
#è¿”å› HTTP/1.1 200 OK å³ä¸ºæˆåŠŸ
```

### åœºæ™¯ B: å–æ¶ˆä»£ç†

å¦‚æœéœ€è¦å›å›½å†…ç½‘ç»œï¼ˆå¦‚ä¸‹è½½å›½å†…æºæ•°æ®ï¼‰ï¼š

```bash
unset http_proxy https_proxy all_proxy
```

### åœºæ™¯ C: è®¾ç½®å¿«æ·åˆ«å (å¯é€‰)

ä½ å¯ä»¥æŠŠå‘½ä»¤å†™å…¥ `~/.bashrc`ï¼Œæ–¹ä¾¿å¿«é€Ÿåˆ‡æ¢ï¼š

```bash
# ç¼–è¾‘é…ç½®æ–‡ä»¶
echo "alias proxy='export http_proxy=http://127.0.0.1:7890;export https_proxy=http://127.0.0.1:7890;export all_proxy=socks5://127.0.0.1:7891'" >> ~/.bashrc
echo "alias unproxy='unset http_proxy https_proxy all_proxy'" >> ~/.bashrc
source ~/.bashrc
```

  * **ä½¿ç”¨æ–¹æ³•**ï¼šè¾“å…¥ `proxy` å¼€å¯ä»£ç†ï¼Œè¾“å…¥ `unproxy` å…³é—­ä»£ç†ã€‚

-----

## â“ å¸¸è§é—®é¢˜æ’æŸ¥

1.  **æŠ¥é”™ `Can't find MMDB`**

      * **åŸå› **ï¼š`/opt/mihomo` ç›®å½•ä¸‹ç¼ºå¤± `Country.mmdb` æ–‡ä»¶ã€‚
      * **è§£å†³**ï¼šé‡æ–°ä¸Šä¼ è¯¥æ–‡ä»¶ã€‚

2.  **æŠ¥é”™ `address already in use`**

      * **åŸå› **ï¼šç«¯å£å†²çªï¼ˆé€šå¸¸æ˜¯ port å’Œ mixed-port è®¾ç½®äº†ä¸€æ ·ï¼‰ã€‚
      * **è§£å†³**ï¼šä¿®æ”¹ config.yamlï¼Œå°† `mixed-port` æ”¹ä¸º 7893ï¼Œé‡å¯æœåŠ¡ã€‚

3.  **Dashboard è¿ä¸ä¸Š**

      * **åŸå› **ï¼šSSH éš§é“æ²¡å»ºç«‹ï¼Œæˆ–è€… Secret å¯†ç å¡«é”™ã€‚
      * **è§£å†³**ï¼šç¡®è®¤ VS Code ç«¯å£æ˜ å°„å·²å¼€å¯ï¼ŒAPI URL å¡«å†™çš„æ˜¯ `127.0.0.1:9090`ã€‚

-----

### ğŸ“„ æ–‡æ¡£æ›´æ–°ï¼šLinux é…ç½® Mihomo æŒ‡å— (v2.0 è¡¥å……ç‰ˆ)

è¿™ä»½æ–‡æ¡£åœ¨åŸç‰ˆåŸºç¡€ä¸Šï¼Œ**å¢åŠ äº†å…³äºæ•°æ®åº“æ–‡ä»¶çš„è§£é‡Š**ï¼Œå¹¶**ä¸“é—¨è¡¥å……äº†æ‰‹åŠ¨/åå°å¯åŠ¨çš„è¯¦ç»†å‘½ä»¤**ï¼Œé€‚åˆä¸æ–¹ä¾¿é…ç½® Systemd çš„ç¯å¢ƒï¼ˆå¦‚ AutoDL å®¹å™¨ï¼‰ã€‚

#### 1\. æ ¸å¿ƒæ–‡ä»¶æ£€æŸ¥ (å¿…è¯»)

åœ¨ `/opt/mihomo/` ç›®å½•ä¸‹ï¼Œ**å¿…é¡»** å­˜åœ¨ä»¥ä¸‹æ–‡ä»¶ï¼Œç¼ºä¸€ä¸å¯ï¼š

  * **`mihomo`**: ä¸»ç¨‹åº (è¦æœ‰æ‰§è¡Œæƒé™ `chmod +x`)
  * **`config.yaml`**: é…ç½®æ–‡ä»¶
  * **`Country.mmdb`**: åŸºç¡€ IP æ•°æ®åº“ (å¿…é¡»)
  * **`geosite.dat`**: åŸŸååˆ†ç±»æ•°æ®åº“ (**å¼ºçƒˆå»ºè®®å®‰è£…**ï¼Œå¦åˆ™ `GEOSITE` è§„åˆ™å¤±æ•ˆ)
  * **`geoip.dat`**: IP åˆ†ç±»æ•°æ®åº“ (**å¼ºçƒˆå»ºè®®å®‰è£…**ï¼Œå¦åˆ™ `GEOIP` è§„åˆ™å¤±æ•ˆ)

*(æ³¨ï¼šå¦‚æœç¼ºå¤± dat æ–‡ä»¶ï¼Œè¯·å‚è€ƒä¸Šä¸€ç‰ˆæŒ‡å—æ‰‹åŠ¨ä¸Šä¼ )*

#### 2\. å¯åŠ¨æœåŠ¡çš„æ–¹æ³• (ä¸‰ç§æ–¹å¼)

æ ¹æ®ä½ çš„éœ€æ±‚é€‰æ‹©ä¸€ç§å¯åŠ¨æ–¹å¼ã€‚

##### æ–¹å¼ Aï¼šå‰å°å¯åŠ¨ (è°ƒè¯•ç”¨)

  * **é€‚ç”¨åœºæ™¯**ï¼šç¬¬ä¸€æ¬¡å®‰è£…æµ‹è¯•ï¼Œæˆ–è€…æŸ¥çœ‹æŠ¥é”™ä¿¡æ¯ã€‚
  * **ç¼ºç‚¹**ï¼šå ç”¨ä¸€ä¸ªç»ˆç«¯çª—å£ï¼Œ**å…³æ‰çª—å£æœåŠ¡å°±æ–­äº†**ã€‚
  * **å‘½ä»¤**ï¼š
    ```bash
    /opt/mihomo/mihomo -d /opt/mihomo -f /opt/mihomo/config.yaml
    ```
  * **åœæ­¢æ–¹æ³•**ï¼šæŒ‰ `Ctrl + C`ã€‚

##### æ–¹å¼ Bï¼šåå°å¯åŠ¨ (æ¨è - é€‚åˆ AutoDL/æ—  root æƒé™)

  * **é€‚ç”¨åœºæ™¯**ï¼šä¸æƒ³é…ç½® Systemdï¼Œæˆ–è€… AutoDL å®¹å™¨ç¯å¢ƒã€‚å³ä½¿å…³é—­ SSH çª—å£ï¼Œä»£ç†ä¾ç„¶åœ¨åå°è¿è¡Œã€‚

  * **å‘½ä»¤ (ä½¿ç”¨ nohup)**ï¼š

    ```bash
    # å¯åŠ¨å¹¶å°†æ—¥å¿—è¾“å‡ºåˆ° mi.log æ–‡ä»¶
    nohup /opt/mihomo/mihomo -d /opt/mihomo -f /opt/mihomo/config.yaml > /opt/mihomo/mi.log 2>&1 &
    ```

    *(æ‰§è¡Œå®Œåï¼Œç»ˆç«¯ä¸ä¼šæœ‰ååº”ï¼Œè¿™æ˜¯æ­£å¸¸çš„)*

  * **æ£€æŸ¥æ˜¯å¦è¿è¡ŒæˆåŠŸ**ï¼š

    ```bash
    # æŸ¥çœ‹è¿›ç¨‹
    ps -ef | grep mihomo
    ```

  * **æŸ¥çœ‹è¿è¡Œæ—¥å¿—**ï¼š

    ```bash
    tail -f /opt/mihomo/mi.log
    ```

  * **åœæ­¢æœåŠ¡**ï¼š
    éœ€è¦æ‰‹åŠ¨æŸ¥æ‰¾è¿›ç¨‹ ID å¹¶æ€æ‰ï¼š

    ```bash
    pkill mihomo
    ```

##### æ–¹å¼ Cï¼šSystemd ç³»ç»ŸæœåŠ¡ (æœ€ç¨³å®š - é€‚åˆé•¿æœŸæœåŠ¡å™¨)

  * **é€‚ç”¨åœºæ™¯**ï¼šæ‹¥æœ‰ root æƒé™çš„é•¿æœŸæœåŠ¡å™¨ï¼Œå¼€æœºè‡ªåŠ¨è¿è¡Œã€‚
  * **å‘½ä»¤**ï¼š
    ```bash
    systemctl start mihomo
    ```
    *(å…·ä½“é…ç½®æ–¹æ³•è§ä¸Šä¸€ç‰ˆæŒ‡å—)*

#### 3\. è®¾ç½®ç¯å¢ƒå˜é‡ (ä½¿ç”¨ä»£ç†)

Mihomo å¯åŠ¨åï¼Œä½ éœ€è¦å‘Šè¯‰ Linux ç³»ç»Ÿå»ä½¿ç”¨å®ƒã€‚

**ä¸´æ—¶ç”Ÿæ•ˆ (å¤åˆ¶ç²˜è´´å³å¯)ï¼š**

```bash
export http_proxy=http://127.0.0.1:7890
export https_proxy=http://127.0.0.1:7890
export all_proxy=socks5://127.0.0.1:7891
```

**å–æ¶ˆä»£ç†ï¼š**

```bash
unset http_proxy https_proxy all_proxy
```

#### 4\. Web Dashboard è¿æ¥ (é€šè¿‡ SSH éš§é“)

AutoDL ç”¨æˆ· **å¿…é¡»** ä½¿ç”¨ SSH éš§é“ï¼Œå¦åˆ™æ— æ³•è®¿é—®ã€‚

1.  **å»ºç«‹éš§é“**ï¼š
      * **VS Code**: Ports -\> Add Port -\> `9090`ã€‚
      * **SSH å‘½ä»¤**: `ssh -L 9090:127.0.0.1:9090 ...`ã€‚
2.  **è®¿é—®é¢æ¿**ï¼š
      * æµè§ˆå™¨æ‰“å¼€: [http://yacd.haishan.me/](http://yacd.haishan.me/)æˆ–[https://metacubex.github.io/metacubexd/#/overview](https://metacubex.github.io/metacubexd/#/overview)
      * **Host**: `127.0.0.1` (ä¸è¦å¡« IP)
      * **Port**: `9090`
      * **Secret**: `123456` (ä½ çš„å¯†ç )

